  Future<Map<String, dynamic>> _callServer(String side, Uint8List bytes) async {
    final req = http.MultipartRequest('POST', Uri.parse(kAiEndpoint));

    req.fields['exam_id'] = widget.examId;
    req.fields['age'] = widget.age.toString();
    req.fields['gender'] = widget.gender;
    req.fields['locale'] = 'ru';
    req.fields['task'] = 'Иридодиагностика';
    req.fields['side'] = side;

    req.files.add(
      http.MultipartFile.fromBytes(
        'file',
        bytes,
        filename: '${widget.examId}_$side.jpg',
      ),
    );

    final streamed = await req.send();
    final resp = await http.Response.fromStream(streamed);

    if (resp.statusCode != 200) {
      debugPrint('❌ AI error: HTTP ${resp.statusCode}');
      return null;
    }

    final decoded = json.decode(resp.body);
    return decoded is Map<String, dynamic> ? decoded : null;
  }
